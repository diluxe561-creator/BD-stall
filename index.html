<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="BDStall - Premium tech store with the latest smartphones, laptops, and accessories. Fast delivery and unbeatable prices.">
    <title>BDStall - Premium Tech Store</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://images.unsplash.com">
    
    <!-- Font Awesome with integrity -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
          crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <style>
        /* ============================================
           CSS VARIABLES & DESIGN TOKENS
           ============================================ */
        :root {
            /* Colors */
            --color-primary: #ff6b35;
            --color-primary-hover: #e55a2b;
            --color-primary-dark: #c44720;
            --color-text: #1a1a2e;
            --color-text-secondary: #4b5563;
            --color-text-muted: #6b7280;
            --color-bg: #ffffff;
            --color-bg-secondary: #f9fafb;
            --color-bg-tertiary: #f3f4f6;
            --color-border: #e5e7eb;
            --color-success: #10b981;
            --color-error: #ef4444;
            
            /* Spacing scale (8px base) */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            
            /* Typography */
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            --font-size-5xl: 3rem;
            
            /* Layout */
            --container-max: 1280px;
            --header-height: 4rem;
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 250ms ease;
            --transition-slow: 350ms ease;
        }

        /* Dark mode */
        [data-theme="dark"] {
            --color-text: #f8fafc;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-bg: #0f172a;
            --color-bg-secondary: #1e293b;
            --color-bg-tertiary: #334155;
            --color-border: #475569;
        }

        /* ============================================
           RESET & BASE STYLES
           ============================================ */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }

        @media (prefers-reduced-motion: reduce) {
            html {
                scroll-behavior: auto;
            }
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body {
            font-family: var(--font-sans);
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--color-text);
            background-color: var(--color-bg);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Focus styles */
        :focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Skip link */
        .skip-link {
            position: absolute;
            top: -100%;
            left: var(--space-4);
            background: var(--color-primary);
            color: white;
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 600;
            z-index: 9999;
            transition: top var(--transition-fast);
        }

        .skip-link:focus {
            top: var(--space-4);
        }

        /* ============================================
           UTILITY CLASSES
           ============================================ */
        .container {
            width: 100%;
            max-width: var(--container-max);
            margin-inline: auto;
            padding-inline: var(--space-4);
        }

        @media (min-width: 640px) {
            .container {
                padding-inline: var(--space-6);
            }
        }

        /* ============================================
           BUTTON COMPONENT
           ============================================ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            font-size: var(--font-size-base);
            font-weight: 600;
            line-height: 1.5;
            text-decoration: none;
            border: 2px solid transparent;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .btn:focus-visible {
            outline-offset: 4px;
        }

        .btn--primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn--primary:hover {
            background-color: var(--color-primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), 0 0 0 4px rgba(255, 107, 53, 0.2);
        }

        .btn--primary:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        /* ============================================
           ICON BUTTON COMPONENT
           ============================================ */
        .icon-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius-full);
            border: none;
            background: transparent;
            color: var(--color-text);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .icon-btn:hover {
            background-color: var(--color-bg-secondary);
            color: var(--color-primary);
        }

        .icon-btn:focus-visible {
            outline-offset: 2px;
        }

        .icon-btn__badge {
            position: absolute;
            top: -2px;
            right: -2px;
            min-width: 1.25rem;
            height: 1.25rem;
            padding: 0 0.25rem;
            background: var(--color-primary);
            color: white;
            font-size: var(--font-size-xs);
            font-weight: 700;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ============================================
           SEARCH COMPONENT
           ============================================ */
        .search {
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        .search__input {
            width: 100%;
            padding: var(--space-3) var(--space-4) var(--space-3) var(--space-10);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-full);
            font-size: var(--font-size-base);
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: all var(--transition-fast);
        }

        .search__input:hover {
            border-color: var(--color-text-muted);
        }

        .search__input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .search__icon {
            position: absolute;
            left: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none;
        }

        /* ============================================
           CARD COMPONENTS
           ============================================ */
        .card {
            background-color: var(--color-bg-secondary);
            border-radius: var(--radius-xl);
            overflow: hidden;
            transition: all var(--transition-base);
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--color-primary);
        }

        /* Category Card */
        .category-card {
            background-color: var(--color-bg-secondary);
            border-radius: var(--radius-xl);
            overflow: hidden;
            transition: all var(--transition-base);
            border: 2px solid transparent;
            padding: var(--space-6);
            text-align: center;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--color-primary);
        }

        .category-card__icon {
            width: 3.75rem;
            height: 3.75rem;
            background-color: var(--color-bg);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-inline: auto;
            margin-bottom: var(--space-4);
            font-size: var(--font-size-xl);
            color: var(--color-primary);
            transition: transform var(--transition-base);
        }

        .category-card:hover .category-card__icon {
            transform: scale(1.1) rotate(5deg);
        }

        .category-card__name {
            font-weight: 600;
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }

        /* Product Card */
        .product-card {
            background-color: var(--color-bg-secondary);
            border-radius: var(--radius-xl);
            overflow: hidden;
            transition: all var(--transition-base);
            border: 2px solid transparent;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--color-primary);
        }

        .product-card__media {
            position: relative;
            aspect-ratio: 4/3;
            background-color: var(--color-bg);
            overflow: hidden;
        }

        .product-card__image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: var(--space-6);
            transition: transform var(--transition-slow);
        }

        .product-card:hover .product-card__image {
            transform: scale(1.08);
        }

        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, var(--color-bg-tertiary) 25%, var(--color-bg-secondary) 50%, var(--color-bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .product-card__image.skeleton {
            position: absolute;
            inset: 0;
        }

        .product-card__badge {
            position: absolute;
            top: var(--space-4);
            left: var(--space-4);
            padding: var(--space-1) var(--space-3);
            background: var(--color-primary);
            color: white;
            font-size: var(--font-size-xs);
            font-weight: 700;
            border-radius: var(--radius-full);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .product-card__content {
            padding: var(--space-5);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .product-card__category {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-2);
        }

        .product-card__title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: var(--space-3);
            line-height: 1.3;
        }

        .product-card__price {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-top: auto;
        }

        .product-card__current-price {
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: var(--color-primary);
        }

        .product-card__original-price {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
            text-decoration: line-through;
        }

        .product-card__action {
            position: absolute;
            bottom: var(--space-5);
            right: var(--space-5);
            width: 2.5rem;
            height: 2.5rem;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(10px);
            transition: all var(--transition-base);
            box-shadow: var(--shadow-md);
        }

        .product-card:hover .product-card__action {
            opacity: 1;
            transform: translateY(0);
        }

        .product-card__action:hover {
            background: var(--color-primary-hover);
            transform: scale(1.1);
        }

        .product-card__action:focus-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ============================================
           TOAST COMPONENT
           ============================================ */
        .toast {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            background: var(--color-text);
            color: white;
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            box-shadow: var(--shadow-xl);
            transform: translateX(150%);
            transition: transform var(--transition-slow) cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 9999;
            max-width: 400px;
        }

        .toast--visible {
            transform: translateX(0);
        }

        .toast__icon {
            color: var(--color-success);
            font-size: var(--font-size-xl);
        }

        /* ============================================
           HEADER LAYOUT
           ============================================ */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
        }

        [data-theme="dark"] .header {
            background: rgba(15, 23, 42, 0.95);
        }

        .header__container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: var(--header-height);
            gap: var(--space-4);
        }

        .header__brand {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: var(--color-text);
            text-decoration: none;
            flex-shrink: 0;
        }

        .header__brand-icon {
            color: var(--color-primary);
        }

        .header__search {
            flex: 1;
            display: none;
        }

        @media (min-width: 768px) {
            .header__search {
                display: block;
            }
        }

        .header__actions {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .mobile-toggle {
            display: flex;
        }

        @media (min-width: 768px) {
            .mobile-toggle {
                display: none;
            }
        }

        /* ============================================
           HERO LAYOUT
           ============================================ */
        .hero {
            padding-block: var(--space-8);
        }

        .hero__container {
            background: linear-gradient(135deg, var(--color-bg-secondary) 0%, var(--color-bg-tertiary) 100%);
            border-radius: var(--radius-2xl);
            padding: var(--space-8) var(--space-6);
            display: grid;
            gap: var(--space-8);
            align-items: center;
            position: relative;
            overflow: hidden;
            isolation: isolate;
        }

        @media (min-width: 968px) {
            .hero__container {
                grid-template-columns: 1fr 1fr;
                padding: var(--space-12) var(--space-10);
            }
        }

        .hero__bg-text {
            position: absolute;
            font-size: clamp(4rem, 15vw, 10rem);
            font-weight: 900;
            color: var(--color-text);
            opacity: 0.03;
            z-index: -1;
            user-select: none;
            white-space: nowrap;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .hero__content {
            text-align: center;
        }

        @media (min-width: 968px) {
            .hero__content {
                text-align: left;
            }
        }

        .hero__title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: var(--space-4);
            color: var(--color-text);
        }

        .hero__description {
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
            max-width: 40ch;
            margin-inline: auto;
        }

        @media (min-width: 968px) {
            .hero__description {
                margin-inline: 0;
            }
        }

        .hero__media {
            display: flex;
            justify-content: center;
            align-items: center;
            order: -1;
        }

        @media (min-width: 968px) {
            .hero__media {
                order: 1;
            }
        }

        .hero__image {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.2));
            transform: rotate(-3deg);
            transition: transform var(--transition-slow);
        }

        .hero__media:hover .hero__image {
            transform: rotate(0deg) scale(1.02);
        }

        /* ============================================
           SECTION LAYOUT
           ============================================ */
        .section {
            padding-block: var(--space-12);
        }

        .section__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-8);
            gap: var(--space-4);
        }

        .section__title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-text);
        }

        .section__link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 600;
            font-size: var(--font-size-sm);
            transition: gap var(--transition-fast);
            white-space: nowrap;
        }

        .section__link:hover {
            gap: var(--space-3);
            text-decoration: underline;
            text-underline-offset: 3px;
        }

        /* ============================================
           GRID SYSTEM
           ============================================ */
        .grid {
            display: grid;
            gap: var(--space-6);
        }

        .grid--categories {
            grid-template-columns: repeat(2, 1fr);
        }

        @media (min-width: 640px) {
            .grid--categories {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .grid--categories {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .grid--products {
            grid-template-columns: repeat(1, 1fr);
        }

        @media (min-width: 640px) {
            .grid--products {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .grid--products {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            .card:hover,
            .hero__image,
            .product-card__image,
            .category-card__icon {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to content -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="container header__container">
            <a href="/" class="header__brand" aria-label="BDStall Home">
                <i class="fas fa-bolt header__brand-icon" aria-hidden="true"></i>
                <span>BDStall</span>
            </a>

            <div class="search header__search" role="search">
                <i class="fas fa-search search__icon" aria-hidden="true"></i>
                <input 
                    type="search" 
                    class="search__input" 
                    placeholder="Search products..." 
                    aria-label="Search products"
                    autocomplete="off"
                    id="search-input"
                >
            </div>

            <div class="header__actions">
                <button class="icon-btn mobile-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
                
                <button class="icon-btn" aria-label="Wishlist">
                    <i class="far fa-heart" aria-hidden="true"></i>
                </button>
                
                <a href="cart.html" class="icon-btn" aria-label="Shopping cart">
                    <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                    <span class="icon-btn__badge" id="cart-badge" aria-label="Items in cart">3</span>
                </a>
                
                <button class="icon-btn" aria-label="Account">
                    <i class="far fa-user" aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Hero Section -->
        <section class="hero" aria-labelledby="hero-heading">
            <div class="container hero__container">
                <span class="hero__bg-text" aria-hidden="true">TECH</span>
                
                <div class="hero__content">
                    <h1 id="hero-heading" class="hero__title">
                        All the Tech You Need,<br>All in One Place
                    </h1>
                    <p class="hero__description">
                        Discover the latest smartphones, laptops, accessories, and more. Premium quality tech at unbeatable prices with fast delivery.
                    </p>
                    <a href="shop.html" class="btn btn--primary">
                        Shop Now
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                    </a>
                </div>

                <div class="hero__media">
                    <img 
                        src="https://images.unsplash.com/photo-1696446701796-da61225697cc?w=600&h=800&fit=crop&q=80" 
                        alt="iPhone 15 Pro Max in Natural Titanium displaying iOS home screen" 
                        class="hero__image"
                        loading="eager"
                        width="400"
                        height="600"
                    >
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="section" aria-labelledby="categories-heading">
            <div class="container">
                <div class="section__header">
                    <h2 id="categories-heading" class="section__title">Popular Categories</h2>
                    <a href="#" class="section__link">
                        View All
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                    </a>
                </div>

                <div class="grid grid--categories" role="list">
                    <article class="category-card" role="listitem" tabindex="0" data-category="computers">
                        <div class="category-card__icon" aria-hidden="true">
                            <i class="fas fa-laptop"></i>
                        </div>
                        <h3 class="category-card__name">Computers</h3>
                    </article>

                    <article class="category-card" role="listitem" tabindex="0" data-category="phones">
                        <div class="category-card__icon" aria-hidden="true">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="category-card__name">Cell Phones</h3>
                    </article>

                    <article class="category-card" role="listitem" tabindex="0" data-category="electronics">
                        <div class="category-card__icon" aria-hidden="true">
                            <i class="fas fa-headphones"></i>
                        </div>
                        <h3 class="category-card__name">Electronics</h3>
                    </article>

                    <article class="category-card" role="listitem" tabindex="0" data-category="travel">
                        <div class="category-card__icon" aria-hidden="true">
                            <i class="fas fa-plane"></i>
                        </div>
                        <h3 class="category-card__name">Travel</h3>
                    </article>

                    <article class="category-card" role="listitem" tabindex="0" data-category="fashion">
                        <div class="category-card__icon" aria-hidden="true">
                            <i class="fas fa-tshirt"></i>
                        </div>
                        <h3 class="category-card__name">Fashion</h3>
                    </article>

                    <article class="category-card" role="listitem" tabindex="0" data-category="automotive">
                        <div class="category-card__icon" aria-hidden="true">
                            <i class="fas fa-car"></i>
                        </div>
                        <h3 class="category-card__name">Car & Bike</h3>
                    </article>
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section class="section" aria-labelledby="products-heading">
            <div class="container">
                <div class="section__header">
                    <h2 id="products-heading" class="section__title">Mobile For All</h2>
                    <a href="shop.html" class="section__link">
                        View All
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                    </a>
                </div>

                <div class="grid grid--products" role="list" id="products-grid">
                    <!-- Products injected by JS -->
                </div>
            </div>
        </section>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true">
        <i class="fas fa-check-circle toast__icon" aria-hidden="true"></i>
        <span id="toast-message"></span>
    </div>

    <script>
        /**
         * BDStall - Senior Frontend Architecture
         * Modular, accessible, performant
         */

        // ==========================================
        // CONFIGURATION
        // ==========================================
        const CONFIG = {
            ANIMATION_DURATION: 300,
            TOAST_DURATION: 3000,
            CART_KEY: 'bdstall_cart',
            THEME_KEY: 'bdstall_theme'
        };

        // ==========================================
        // OBSERVABLE STATE STORE
        // ==========================================
        class Store {
            constructor(initialState = {}) {
                this.state = new Map(Object.entries(initialState));
                this.listeners = new Map();
            }

            get(key) {
                return this.state.get(key);
            }

            set(key, value) {
                const oldValue = this.state.get(key);
                this.state.set(key, value);
                this.notify(key, value, oldValue);
            }

            subscribe(key, callback) {
                if (!this.listeners.has(key)) {
                    this.listeners.set(key, new Set());
                }
                this.listeners.get(key).add(callback);
                return () => this.listeners.get(key).delete(callback);
            }

            notify(key, newValue, oldValue) {
                if (this.listeners.has(key)) {
                    this.listeners.get(key).forEach(cb => cb(newValue, oldValue));
                }
            }
        }

        const appState = new Store({
            cartCount: 3,
            theme: localStorage.getItem(CONFIG.THEME_KEY) || 'light',
            isLoading: false
        });

        // ==========================================
        // CART MODULE
        // ==========================================
        const CartModule = (() => {
            const init = () => {
                const saved = localStorage.getItem(CONFIG.CART_KEY);
                const cart = saved ? JSON.parse(saved) : { items: [], count: 3 };
                appState.set('cartCount', cart.count);
            };

            const addItem = (product) => {
                const currentCount = appState.get('cartCount');
                appState.set('cartCount', currentCount + 1);
                
                const cart = { count: currentCount + 1, lastAdded: product };
                localStorage.setItem(CONFIG.CART_KEY, JSON.stringify(cart));
                
                window.dispatchEvent(new CustomEvent('cart:add', { 
                    detail: { product, timestamp: Date.now() } 
                }));

                return currentCount + 1;
            };

            const getCount = () => appState.get('cartCount');

            appState.subscribe('cartCount', (newCount) => {
                const badge = document.getElementById('cart-badge');
                if (badge) {
                    badge.textContent = newCount;
                    badge.style.transform = 'scale(1.3)';
                    setTimeout(() => badge.style.transform = 'scale(1)', 200);
                }
            });

            return { init, addItem, getCount };
        })();

        // ==========================================
        // UI MODULE
        // ==========================================
        const UIModule = (() => {
            let toastTimeout;

            const showToast = (message, type = 'success') => {
                const toast = document.getElementById('toast');
                const messageEl = document.getElementById('toast-message');
                
                if (!toast || !messageEl) return;

                clearTimeout(toastTimeout);
                
                messageEl.textContent = message;
                toast.classList.add('toast--visible');
                toast.setAttribute('aria-label', message);

                toastTimeout = setTimeout(() => {
                    toast.classList.remove('toast--visible');
                }, CONFIG.TOAST_DURATION);
            };

            const initTheme = () => {
                const theme = appState.get('theme');
                document.documentElement.setAttribute('data-theme', theme);
            };

            const toggleTheme = () => {
                const current = appState.get('theme');
                const next = current === 'light' ? 'dark' : 'light';
                appState.set('theme', next);
                document.documentElement.setAttribute('data-theme', next);
                localStorage.setItem(CONFIG.THEME_KEY, next);
            };

            return { showToast, initTheme, toggleTheme };
        })();

        // ==========================================
        // PRODUCT MODULE
        // ==========================================
        const ProductModule = (() => {
            const products = [
                {
                    id: 1,
                    name: 'iPhone 14 Pro Max',
                    category: 'Smartphone',
                    price: 999,
                    originalPrice: 1199,
                    badge: '-20%',
                    image: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400&h=500&fit=crop&q=80',
                    alt: 'iPhone 14 Pro Max in Deep Purple showing triple camera system and Dynamic Island'
                },
                {
                    id: 2,
                    name: 'Samsung Galaxy S23',
                    category: 'Smartphone',
                    price: 799,
                    image: 'https://images.unsplash.com/photo-1610945265078-3858a0828671?w=400&h=500&fit=crop&q=80',
                    alt: 'Samsung Galaxy S23 in Phantom Black showing rear camera array'
                },
                {
                    id: 3,
                    name: 'Google Pixel 8 Pro',
                    category: 'Smartphone',
                    price: 899,
                    badge: 'New',
                    image: 'https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=400&h=500&fit=crop&q=80',
                    alt: 'Google Pixel 8 Pro in Obsidian displaying home screen'
                },
                {
                    id: 4,
                    name: 'OnePlus 11 5G',
                    category: 'Smartphone',
                    price: 699,
                    originalPrice: 799,
                    image: 'https://images.unsplash.com/photo-1592899677977-9c10ca588bbd?w=400&h=500&fit=crop&q=80',
                    alt: 'OnePlus 11 5G in Titan Black with Hasselblad camera'
                }
            ];

            const createProductCard = (product) => {
                const hasDiscount = product.originalPrice && product.originalPrice > product.price;
                const badgeHTML = product.badge ? `<span class="product-card__badge">${product.badge}</span>` : '';
                const originalPriceHTML = hasDiscount ? `<span class="product-card__original-price">$${product.originalPrice}</span>` : '';
                
                return `
                    <article class="product-card" role="listitem">
                        <div class="product-card__media">
                            ${badgeHTML}
                            <div class="skeleton product-card__image" aria-hidden="true"></div>
                            <img 
                                src="${product.image}" 
                                alt="${product.alt}" 
                                class="product-card__image"
                                loading="lazy"
                                width="300"
                                height="400"
                                onload="this.previousElementSibling.style.display='none'"
                            >
                        </div>
                        <div class="product-card__content">
                            <span class="product-card__category">${product.category}</span>
                            <h3 class="product-card__title">${product.name}</h3>
                            <div class="product-card__price">
                                <span class="product-card__current-price">$${product.price}</span>
                                ${originalPriceHTML}
                            </div>
                        </div>
                        <button 
                            class="product-card__action" 
                            aria-label="Add ${product.name} to cart"
                            data-product-id="${product.id}"
                        >
                            <i class="fas fa-plus" aria-hidden="true"></i>
                        </button>
                    </article>
                `;
            };

            const render = () => {
                const grid = document.getElementById('products-grid');
                if (!grid) return;
                
                grid.innerHTML = products.map(createProductCard).join('');
                
                grid.querySelectorAll('.product-card__action').forEach(btn => {
                    btn.addEventListener('click', handleAddToCart);
                });
            };

            const handleAddToCart = (e) => {
                const button = e.currentTarget;
                const productId = parseInt(button.dataset.productId);
                const product = products.find(p => p.id === productId);
                
                if (!product) return;

                CartModule.addItem(product);
                UIModule.showToast(`${product.name} added to cart!`);
                
                button.style.transform = 'scale(0.9)';
                setTimeout(() => button.style.transform = '', 150);
            };

            return { render };
        })();

        // ==========================================
        // CATEGORY MODULE
        // ==========================================
        const CategoryModule = (() => {
            const init = () => {
                const cards = document.querySelectorAll('.category-card');
                
                cards.forEach(card => {
                    card.addEventListener('click', () => selectCategory(card));
                    card.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            selectCategory(card);
                        }
                    });
                });
            };

            const selectCategory = (card) => {
                document.querySelectorAll('.category-card').forEach(c => {
                    c.style.borderColor = '';
                    c.style.background = '';
                });
                
                card.style.borderColor = 'var(--color-primary)';
                card.style.background = 'var(--color-bg)';
                
                const categoryName = card.querySelector('.category-card__name').textContent;
                UIModule.showToast(`Browsing ${categoryName}...`);
                
                window.dispatchEvent(new CustomEvent('category:select', {
                    detail: { category: card.dataset.category, name: categoryName }
                }));
            };

            return { init };
        })();

        // ==========================================
        // SEARCH MODULE
        // ==========================================
        const SearchModule = (() => {
            const init = () => {
                const input = document.getElementById('search-input');
                if (!input) return;

                let debounceTimer;
                
                input.addEventListener('input', (e) => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        performSearch(e.target.value);
                    }, 300);
                });

                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        clearTimeout(debounceTimer);
                        performSearch(e.target.value);
                    }
                });
            };

            const performSearch = (query) => {
                if (!query.trim()) return;
                UIModule.showToast(`Searching for: ${query}`);
            };

            return { init };
        })();

        // ==========================================
        // ANIMATION MODULE
        // ==========================================
        const AnimationModule = (() => {
            const init = () => {
                const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                if (prefersReducedMotion) return;

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.opacity = '1';
                            entry.target.style.transform = 'translateY(0)';
                            observer.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                });

                document.querySelectorAll('.category-card, .product-card').forEach((el, index) => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(20px)';
                    el.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
                    observer.observe(el);
                });
            };

            return { init };
        })();

        // ==========================================
        // INITIALIZATION
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            CartModule.init();
            UIModule.initTheme();
            ProductModule.render();
            CategoryModule.init();
            SearchModule.init();
            AnimationModule.init();

            console.log('ðŸš€ BDStall initialized:', {
                cartCount: CartModule.getCount(),
                theme: appState.get('theme')
            });
        });

        // Debug API
        window.BDStall = {
            state: appState,
            cart: CartModule,
            ui: UIModule
        };
    </script>
</body>
</html>
